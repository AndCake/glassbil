"use strict";var scope="undefined"!=typeof global?global:"undefined"!=typeof window?window:{},eventRegistry=scope.__eventRegistry=scope.__eventRegistry||{};function trigger(t){var e=arguments;if(eventRegistry[t])for(var n,o=0,r=eventRegistry[t].length;n=eventRegistry[t][o],o<r;o+=1){if(!1===n.apply(this,Array.prototype.slice.call(e,1)))break}}function on(t,e){eventRegistry[t]||(eventRegistry[t]=[]),eventRegistry[t].push(e)}function off(t,e){if(eventRegistry[t])if("function"==typeof e){var n=eventRegistry[t].indexOf(e);n>=0&&eventRegistry[t].splice(n,1)}else eventRegistry[t]=[]}function one(t,e){var n=this,o=function(){off(t,o),e.apply(n,Array.prototype.slice.call(arguments))};on(t,o)}function resetEvents(){eventRegistry=scope.__eventRegistry={}}var events=Object.freeze({trigger:trigger,on:on,off:off,one:one,resetEvents:resetEvents}),scope$1="undefined"!=typeof window?window:{},data=scope$1.__glassbilStoreData=scope$1.__glassbilStoreData||{},trigger$1=trigger;function mirror(){return this}function getProperty(t,e){for(var n=e,o=t.split(".");n&&o.length>0;)n=n[o.shift()];return n}function deepFreeze(t){if(null===t||void 0===t||"function"==typeof t.toJS||"object"!=typeof t)return t;var e=Object.getOwnPropertyNames(t),n={toJS:{value:mirror.bind(t)}};Array.isArray(t)&&(t=t.slice(0).map(deepFreeze),["map","forEach","find","indexOf","filter","some","every","lastIndexOf","slice"].forEach(function(e){n[e]={value:function(){return deepFreeze(Array.prototype[e].apply(t,arguments))}}}));for(var o=function(t,o){n[e[t]]={enumerable:!0,get:function(){return deepFreeze(o)},set:function(n){throw new Error('Cannot change property "'+e[t]+'" to "'+n+'" of an immutable object')}}},r=0,i=void 0;i=t[e[r]],r<e.length;r+=1)o(r,i);return Object.freeze(Object.create(Object.getPrototypeOf(t),n))}function bind(t,e,n){return function(o){return t.call(e,o,n)}}var Store=function(t,e){var n=this;this.name=t||"Unnamed"+Object.keys(data).length,Object.keys(events).forEach(function(e){"resetEvents"!==e&&(n[e]=function(n,o){n.indexOf(":")>=0?events[e](n,o):events[e](t+"-store:"+n,o)})}),this.actions(e),t&&(data[t]=data[t]||{loaded:!1,currentData:deepFreeze([])})},prototypeAccessors={data:{configurable:!0}};Store.prototype.actions=function(t){var e=this;if(!t||"object"!=typeof t)return this.actionDefinitions&&Object.keys(this.actionDefinitions)||[];var n=Object.keys(t);this.actionDefinitions=Object.assign({},this.actionDefinitions||{},t);for(var o=function(t,o){(function(t){this[t]=function(e){var n=o.call(this,data[this.name].currentData,e,bind(this.setState,this,t));void 0!==n&&this.setState(n,t)}.bind(this)}).call(e,n[t])},r=0,i=void 0;i=t[n[r]],r<n.length;r+=1)o(r,i);return Object.keys(this.actionDefinitions)},Store.prototype.watch=function(t,e,n){n=n||function(t,e){return t===e};var o=getProperty(t,this.data),r=function(r){var i=getProperty(t,r);n(o,i)||e(i,o,r)};return this.on(this.name+"-store:changed",r),function(){this.off(this.name+"-store:changed",r)}.bind(this)},prototypeAccessors.data.get=function(){return data[this.name]&&data[this.name].loaded?data[this.name].currentData:null},Store.prototype.loaded=function(){var t=Object.keys(data).filter(function(t){return data[t].loaded}).length;if(t===Object.keys(data).length&&!data.__triggered){var e={};Object.keys(data).map(function(t){e[t]=data[t].currentData.toJS()}),data.__triggered=!0,trigger$1("global:data-loaded",e)}},Store.prototype.reset=function(){return Object.getPrototypeOf(this)===Store.prototype&&(data=scope$1.__glassbilStoreData={},resetEvents(),!0)},Store.prototype.setState=function(t,e){void 0===e&&(e="setState"),data[this.name].loaded=!0,(t=deepFreeze(t))!==data[this.name].currentData&&(data[this.name].currentData=t,trigger$1(this.name+"-store:changed",data[this.name].currentData,e)),this.loaded()},Object.defineProperties(Store.prototype,prototypeAccessors);var TestStore=function(t){function e(){t.call(this,"test"),this.actions({added:function(t,e,n){var o=t.toJS();return o.push(e),o},removed:function(t,e,n){var o=t.toJS(),r=o.find(function(t){return t.id===e});r&&o.splice(o.indexOf(r),1),n(o)},updated:function(t,e,n){var o=t.toJS(),r=o.find(function(t){return t.id===e.id});return r&&Object.assign(r,e),o}})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Store);function glassbilDevTools(t){var e=window.devToolsExtension||window.top.devToolsExtension,n=!1;return e?t.devtools?t:(t.devtools=e.connect({name:t.name,features:{skip:!1}}),t.devtools.subscribe(function(e){if("DISPATCH"===e.type&&e.state){if("TOGGLE_ACTION"===e.payload.type)return void console.warn("Skipping not implemented yet.");n="JUMP_TO_ACTION"===e.payload.type||"JUMP_TO_STATE"===e.payload.type,'{"length":0}'===e.state&&(e.state="[]"),t.setState(JSON.parse(e.state))}}),t.devtools.init(t.data),t.on("changed",function(e,o){o=o||"setState",n?n=!1:t.devtools.send(o,e.toJS())}),t):(console.warn("Please install/enable the Redux devtools extension."),t.devtools=null,t)}var store=glassbilDevTools(new TestStore);store.on("changed",function(t){document.querySelector("ul").innerHTML=t.map(function(t){return'\n\t\t<li data-id="'+t.id+'">\n\t\t\t'+t.value+"\n\t\t</li>\n\t"}).join("")}),document.querySelector("input").addEventListener("change",function(){store.added({id:(store.data.length&&store.data[store.data.length-1].id||0)+1,value:this.value}),this.value="",this.focus()}),document.querySelector("ul").addEventListener("click",function(t){t.target.matches("li")&&store.removed(~~t.target.dataset.id)});
