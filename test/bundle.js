"use strict";var scope="undefined"!=typeof global?global:"undefined"!=typeof window?window:{},eventRegistry=scope.__eventRegistry=scope.__eventRegistry||{};function trigger(e){var t=arguments;if(eventRegistry[e])for(var n,o=0,r=eventRegistry[e].length;n=eventRegistry[e][o],o<r;o+=1){if(!1===n.apply(this,Array.prototype.slice.call(t,1)))break}}function on(e,t){eventRegistry[e]||(eventRegistry[e]=[]),eventRegistry[e].push(t)}function off(e,t){if(eventRegistry[e])if("function"==typeof t){var n=eventRegistry[e].indexOf(t);n>=0&&eventRegistry[e].splice(n,1)}else eventRegistry[e]=[]}function one(e,t){var n=this,o=function(){off(e,o),t.apply(n,Array.prototype.slice.call(arguments))};on(e,o)}var events=Object.freeze({trigger:trigger,on:on,off:off,one:one}),scope$1="undefined"!=typeof window?window:{},data=scope$1.__glassbilStoreData=scope$1.__glassbilStoreData||{},trigger$1=trigger;function mirror(){return this}function deepFreeze(e){if(null===e||"function"==typeof e.toJS||"object"!=typeof e)return e;var t=Object.getOwnPropertyNames(e),n={toJS:{value:mirror.bind(e)}};Array.isArray(e)&&(e=e.slice(0).map(deepFreeze),["map","forEach","find","indexOf","filter","some","every","lastIndexOf","slice"].forEach(function(t){n[t]={value:function(){return deepFreeze(Array.prototype[t].apply(e,arguments))}}}));for(var o=function(e,o){n[t[e]]={enumerable:!0,get:function(){return deepFreeze(o)},set:function(n){throw new Error('Cannot change property "'+t[e]+'" to "'+n+'" of an immutable object')}}},r=0,a=void 0;a=e[t[r]],r<t.length;r+=1)o(r,a);return Object.freeze(Object.create(Object.getPrototypeOf(e),n))}function bind(e,t,n){return function(o){return e.call(t,o,n)}}var Store=function(e,t){var n=this;this.name=e||"unnamed",this.triggered=!1,Object.keys(events).forEach(function(t){n[t]=function(n,o){n.indexOf(":")>=0?events[t](n,o):events[t](e+"-store:"+n,o)}}),this.actions(t),e&&(data[e]=data[e]||{loaded:!1,currentData:deepFreeze([])})},prototypeAccessors={data:{configurable:!0}};Store.prototype.actions=function(e){var t=this;if(e&&"object"==typeof e)for(var n=Object.keys(e),o=function(e,o){(function(e){this[e]=function(t){var n=o(data[this.name].currentData,t,bind(this.next,this,e));void 0!==n&&this.next(n,e)}.bind(this)}).call(t,n[e])},r=0,a=void 0;a=e[n[r]],r<n.length;r+=1)o(r,a)},prototypeAccessors.data.get=function(){return data[this.name]?data[this.name].currentData:null},Store.prototype.loaded=function(){var e=Object.keys(data).filter(function(e){return data[e].loaded}).length;if(e===Object.keys(data).length&&!this.triggered){var t={};Object.keys(data).map(function(e){t[e]=data[e].currentData.toJS()}),this.triggered=!0,trigger$1("global:data-loaded",t)}},Store.prototype.next=function(e,t){data[this.name].loaded=!0,(e=deepFreeze(e))!==data[this.name].currentData&&(data[this.name].currentData=e,trigger$1(this.name+"-store:changed",data[this.name].currentData,t)),this.loaded()},Object.defineProperties(Store.prototype,prototypeAccessors);var TestStore=function(e){function t(){e.call(this,"test"),this.actions({added:function(e,t,n){var o=e.toJS();return o.push(t),o},removed:function(e,t,n){var o=e.toJS(),r=o.find(function(e){return e.id===t});r&&o.splice(o.indexOf(r),1),n(o)}})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Store);function glassbilDevTools(e){var t=window.devToolsExtension||window.top.devToolsExtension,n=!1;return t?e.devtools?e:(e.devtools=t.connect(),e.devtools.subscribe(function(t){if("DISPATCH"===t.type&&t.state){if("TOGGLE_ACTION"===t.payload.type)return void console.warn("Skipping not implemented yet.");n="JUMP_TO_ACTION"===t.payload.type||"JUMP_TO_STATE"===t.payload.type,'{"length":0}'===t.state&&(t.state="[]"),e.next(JSON.parse(t.state))}}),e.devtools.init(e.data),e.on("changed",function(t,o){o=o||"next",n?n=!1:e.devtools.send(o,t.toJS())}),e):(console.warn("Please install/enable the Redux devtools extension."),e.devtools=null,e)}var store=glassbilDevTools(new TestStore);store.on("changed",function(e){document.querySelector("ul").innerHTML=e.map(function(e){return'<li data-id="'+e.id+'">'+e.value+"</li>"}).join("")}),document.querySelector("input").addEventListener("change",function(){store.added({id:(store.data.length&&store.data[store.data.length-1].id||0)+1,value:this.value})}),document.querySelector("ul").addEventListener("click",function(e){e.target.matches("li")&&store.removed(~~e.target.dataset.id)});
