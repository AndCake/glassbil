!function(){"use strict";var t="undefined"!=typeof global?global:"undefined"!=typeof window?window:{},e=t.__eventRegistry=t.__eventRegistry||{};function n(t){var n=arguments;if(e[t])for(var i,o=0,a=e[t].length;i=e[t][o],o<a;o+=1){if(!1===i.apply(this,Array.prototype.slice.call(n,1)))break}}function i(t,n){e[t]||(e[t]=[]),e[t].push(n)}function o(t,n){if(e[t])if("function"==typeof n){var i=e[t].indexOf(n);i>=0&&e[t].splice(i,1)}else e[t]=[]}var a=Object.freeze({trigger:n,on:i,off:o,one:function(t,e){var n=this,a=function(){o(t,a),e.apply(n,Array.prototype.slice.call(arguments))};i(t,a)}}),r="undefined"!=typeof window?window:{},s=r.__glassbilStoreData=r.__glassbilStoreData||{},c=n;function f(t){if(null===t||"function"==typeof t.toJS||"object"!=typeof t)return t;var e=Object.getOwnPropertyNames(t),n={toJS:{value:function(){return this}.bind(t)}};Array.isArray(t)&&(t=t.slice(0).map(f),["map","forEach","find","indexOf","filter","some","every","lastIndexOf","slice"].forEach(function(e){n[e]={value:function(){return f(Array.prototype[e].apply(t,arguments))}}}));for(var i=function(t,i){n[e[t]]={enumerable:!0,get:function(){return f(i)},set:function(n){throw new Error('Cannot change property "'+e[t]+'" to "'+n+'" of an immutable object')}}},o=0,a=void 0;a=t[e[o]],o<e.length;o+=1)i(o,a);return Object.freeze(Object.create(Object.getPrototypeOf(t),n))}var u=function(t,e){var n=this;this.name=t||"Unnamed"+Object.keys(s).length,this.triggered=!1,Object.keys(a).forEach(function(e){n[e]=function(n,i){n.indexOf(":")>=0?a[e](n,i):a[e](t+"-store:"+n,i)}}),this.actions(e),t&&(s[t]=s[t]||{loaded:!1,currentData:f([])})},l={data:{configurable:!0}};u.prototype.actions=function(t){var e=this;if(!t||"object"!=typeof t)return this.actionDefinitions&&Object.keys(this.actionDefinitions)||[];var n=Object.keys(t);this.actionDefinitions=Object.assign({},this.actionDefinitions||{},t);for(var i=function(t,i){(function(t){this[t]=function(e){var n,o,a,r=i.call(this,s[this.name].currentData,e,(n=this.setState,o=this,a=t,function(t){return n.call(o,t,a)}));void 0!==r&&this.setState(r,t)}.bind(this)}).call(e,n[t])},o=0,a=void 0;a=t[n[o]],o<n.length;o+=1)i(o,a);return Object.keys(this.actionDefinitions)},l.data.get=function(){return s[this.name]?s[this.name].currentData:null},u.prototype.loaded=function(){var t=Object.keys(s).filter(function(t){return s[t].loaded}).length;if(t===Object.keys(s).length&&!this.triggered){var e={};Object.keys(s).map(function(t){e[t]=s[t].currentData.toJS()}),this.triggered=!0,c("global:data-loaded",e)}},u.prototype.setState=function(t,e){void 0===e&&(e="setState"),s[this.name].loaded=!0,(t=f(t))!==s[this.name].currentData&&(s[this.name].currentData=t,c(this.name+"-store:changed",s[this.name].currentData,e)),this.loaded()},Object.defineProperties(u.prototype,l);var d,p=function(t){function e(){t.call(this,"test"),this.actions({added:function(t,e,n){var i=t.toJS();return i.push(e),i},removed:function(t,e,n){var i=t.toJS(),o=i.find(function(t){return t.id===e});o&&i.splice(i.indexOf(o),1),n(i)}})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(u);d=new p,self.addEventListener("message",function(t){var e=t.data,n=e.type,i=e.messages;if("@@ACTIONS"===n){var o=d.actions();self.postMessage({type:"@@ACTIONS",payload:o})}else{if("@@ACTION"!==n)throw new Error('Unknown message type "'+n+'"');i.forEach(function(t){var e=t.actionName,n=t.data;d[e](n)})}}),d.on("changed",function(t,e){self.postMessage({type:"@@STATE",payload:t,actionName:e})})}();
