!function(){"use strict";var t="undefined"!=typeof global?global:"undefined"!=typeof window?window:{},e=t.__eventRegistry=t.__eventRegistry||{};function n(t){var n=arguments;if(e[t])for(var i,o=0,r=e[t].length;i=e[t][o],o<r;o+=1){if(!1===i.apply(this,Array.prototype.slice.call(n,1)))break}}function i(t,n){e[t]||(e[t]=[]),e[t].push(n)}function o(t,n){if(e[t])if("function"==typeof n){var i=e[t].indexOf(n);i>=0&&e[t].splice(i,1)}else e[t]=[]}function r(){e=t.__eventRegistry={}}var a=Object.freeze({trigger:n,on:i,off:o,one:function(t,e){var n=this,r=function(){o(t,r),e.apply(n,Array.prototype.slice.call(arguments))};i(t,r)},resetEvents:r}),s="undefined"!=typeof window?window:{},c=s.__glassbilStoreData=s.__glassbilStoreData||{},f=n;function u(t,e){for(var n=e,i=t.split(".");n&&i.length>0;)n=n[i.shift()];return n}function d(t){if(null===t||void 0===t||"function"==typeof t.toJS||"object"!=typeof t)return t;var e=Object.getOwnPropertyNames(t),n={toJS:{value:function(){return this}.bind(t)}};Array.isArray(t)&&(t=t.slice(0).map(d),["map","forEach","find","indexOf","filter","some","every","lastIndexOf","slice"].forEach(function(e){n[e]={value:function(){return d(Array.prototype[e].apply(t,arguments))}}}));for(var i=function(t,i){n[e[t]]={enumerable:!0,get:function(){return d(i)},set:function(n){throw new Error('Cannot change property "'+e[t]+'" to "'+n+'" of an immutable object')}}},o=0,r=void 0;r=t[e[o]],o<e.length;o+=1)i(o,r);return Object.freeze(Object.create(Object.getPrototypeOf(t),n))}var l=function(t,e){var n=this;this.name=t||"Unnamed"+Object.keys(c).length,Object.keys(a).forEach(function(e){"resetEvents"!==e&&(n[e]=function(n,i){n.indexOf(":")>=0?a[e](n,i):a[e](t+"-store:"+n,i)})}),this.actions(e),t&&(c[t]=c[t]||{loaded:!1,currentData:d([])})},p={data:{configurable:!0}};l.prototype.actions=function(t){var e=this;if(!t||"object"!=typeof t)return this.actionDefinitions&&Object.keys(this.actionDefinitions)||[];var n=Object.keys(t);this.actionDefinitions=Object.assign({},this.actionDefinitions||{},t);for(var i=function(t,i){(function(t){this[t]=function(e){var n,o,r,a=i.call(this,c[this.name].currentData,e,(n=this.setState,o=this,r=t,function(t){return n.call(o,t,r)}));void 0!==a&&this.setState(a,t)}.bind(this)}).call(e,n[t])},o=0,r=void 0;r=t[n[o]],o<n.length;o+=1)i(o,r);return Object.keys(this.actionDefinitions)},l.prototype.watch=function(t,e,n){n=n||function(t,e){return t===e};var i=u(t,this.data),o=function(o){var r=u(t,o);n(i,r)||e(r,i,o)};return this.on(this.name+"-store:changed",o),function(){this.off(this.name+"-store:changed",o)}.bind(this)},p.data.get=function(){return c[this.name]&&c[this.name].loaded?c[this.name].currentData:null},l.prototype.loaded=function(){var t=Object.keys(c).filter(function(t){return c[t].loaded}).length;if(t===Object.keys(c).length&&!c.__triggered){var e={};Object.keys(c).map(function(t){e[t]=c[t].currentData.toJS()}),c.__triggered=!0,f("global:data-loaded",e)}},l.prototype.reset=function(){return Object.getPrototypeOf(this)===l.prototype&&(c=s.__glassbilStoreData={},r(),!0)},l.prototype.setState=function(t,e){void 0===e&&(e="setState"),c[this.name].loaded=!0,(t=d(t))!==c[this.name].currentData&&(c[this.name].currentData=t,f(this.name+"-store:changed",c[this.name].currentData,e)),this.loaded()},Object.defineProperties(l.prototype,p);var h,y=function(t){function e(){t.call(this,"test"),this.actions({added:function(t,e,n){var i=t.toJS();return i.push(e),i},removed:function(t,e,n){var i=t.toJS(),o=i.find(function(t){return t.id===e});o&&i.splice(i.indexOf(o),1),n(i)},updated:function(t,e,n){var i=t.toJS(),o=i.find(function(t){return t.id===e.id});return o&&Object.assign(o,e),i}})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(l);h=new y,self.addEventListener("message",function(t){var e=t.data,n=e.type,i=e.messages;if("@@ACTIONS"===n){var o=h.actions();self.postMessage({type:"@@ACTIONS",payload:o})}else{if("@@ACTION"!==n)throw new Error('Unknown message type "'+n+'"');i.forEach(function(t){var e=t.actionName,n=t.data;h[e](n)})}}),h.on("changed",function(t,e){self.postMessage({type:"@@STATE",payload:t,actionName:e})})}();
