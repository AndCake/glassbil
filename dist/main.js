"use strict";var scope="undefined"!=typeof global?global:"undefined"!=typeof window?window:{},eventRegistry=scope.__eventRegistry=scope.__eventRegistry||{};function trigger(e){var t=arguments;if(eventRegistry[e])for(var r,n=0,o=eventRegistry[e].length;r=eventRegistry[e][n],n<o;n+=1){if(!1===r.apply(this,Array.prototype.slice.call(t,1)))break}}function on(e,t){eventRegistry[e]||(eventRegistry[e]=[]),eventRegistry[e].push(t)}function off(e,t){if(eventRegistry[e])if("function"==typeof t){var r=eventRegistry[e].indexOf(t);r>=0&&eventRegistry[e].splice(r,1)}else eventRegistry[e]=[]}function one(e,t){var r=this,n=function(){off(e,n),t.apply(r,Array.prototype.slice.call(arguments))};on(e,n)}var events=Object.freeze({trigger:trigger,on:on,off:off,one:one}),scope$1="undefined"!=typeof window?window:{},data=scope$1.__glassbilStoreData=scope$1.__glassbilStoreData||{},trigger$1=trigger;function mirror(){return this}function deepFreeze(e){if(null===e||"function"==typeof e.toJS||"object"!=typeof e)return e;var t=Object.getOwnPropertyNames(e),r={toJS:{value:mirror.bind(e)}};Array.isArray(e)&&(e=e.slice(0).map(deepFreeze),["map","forEach","find","indexOf","filter","some","every","lastIndexOf","slice"].forEach(function(t){r[t]={value:function(){return deepFreeze(Array.prototype[t].apply(e,arguments))}}}));for(var n=function(e,n){r[t[e]]={enumerable:!0,get:function(){return deepFreeze(n)},set:function(r){throw new Error('Cannot change property "'+t[e]+'" to "'+r+'" of an immutable object')}}},o=0,a=void 0;a=e[t[o]],o<t.length;o+=1)n(o,a);return Object.freeze(Object.create(Object.getPrototypeOf(e),r))}function bind(e,t,r){return function(n){return e.call(t,n,r)}}var Store=function(e,t){var r=this;this.name=e||"unnamed",this.triggered=!1,Object.keys(events).forEach(function(t){r[t]=function(r,n){r.indexOf(":")>=0?events[t](r,n):events[t](e+"-store:"+r,n)}}),this.actions(t),e&&(data[e]=data[e]||{loaded:!1,currentData:deepFreeze([])})},prototypeAccessors={data:{configurable:!0}};Store.prototype.actions=function(e){var t=this;if(e&&"object"==typeof e)for(var r=Object.keys(e),n=function(e,n){(function(e){this[e]=function(t){var r=n(data[this.name].currentData,t,bind(this.next,this,e));void 0!==r&&this.next(r,e)}.bind(this)}).call(t,r[e])},o=0,a=void 0;a=e[r[o]],o<r.length;o+=1)n(o,a)},prototypeAccessors.data.get=function(){return data[this.name]?data[this.name].currentData:null},Store.prototype.loaded=function(){var e=Object.keys(data).filter(function(e){return data[e].loaded}).length;if(e===Object.keys(data).length&&!this.triggered){var t={};Object.keys(data).map(function(e){t[e]=data[e].currentData.toJS()}),this.triggered=!0,trigger$1("global:data-loaded",t)}},Store.prototype.next=function(e,t){data[this.name].loaded=!0,(e=deepFreeze(e))!==data[this.name].currentData&&(data[this.name].currentData=e,trigger$1(this.name+"-store:changed",data[this.name].currentData,t)),this.loaded()},Object.defineProperties(Store.prototype,prototypeAccessors),module.exports=Store;
