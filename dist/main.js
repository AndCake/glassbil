"use strict";var eventRegistry={};function trigger(t,e){if(eventRegistry[t])for(var r,a=0,n=eventRegistry[t].length;r=eventRegistry[t][a],a<n;a+=1){if(!1===r(e))break}}function on(t,e){eventRegistry[t]||(eventRegistry[t]=[]),eventRegistry[t].push(e)}function off(t,e){if(eventRegistry[t])if("function"==typeof e){var r=eventRegistry[t].indexOf(e);r>=0&&eventRegistry[t].splice(r,1)}else eventRegistry[t]=[]}function one(t,e){var r=function(a){off(t,r),e(a)};on(t,r)}var events=Object.freeze({trigger:trigger,on:on,off:off,one:one}),data={},trigger$1=trigger;function mirror(){return this}function deepFreeze(t){if(null===t||"function"==typeof t.toJS||"object"!=typeof t)return t;for(var e=Object.getOwnPropertyNames(t),r={toJS:{value:mirror.bind(t)}},a=function(t,a){r[e[t]]={enumerable:!0,get:function(){return deepFreeze(a)},set:function(r){throw new Error('Cannot change property "'+e[t]+'" to "'+r+'" of an immutable object')}}},n=0,o=void 0;o=t[e[n]],n<e.length;n+=1)a(n,o);return Object.freeze(Object.create(Object.getPrototypeOf(t),r))}var Store=function(t,e){var r=this;if(this.name=t||"unnamed",this.triggered=!1,Object.keys(events).forEach(function(e){r[e]=function(r,a){r.indexOf(":")>=0?events[e](r,a):events[e](t+"-store:"+r,a)}}),"object"==typeof e)for(var a=Object.keys(e),n=function(e,n){r[a[e]]=function(e){var r=n(data[t].currentData.toJS(),e,this.next.bind(this));r&&this.next(r)}.bind(r)},o=0,i=void 0;i=e[a[o]],o<a.length;o+=1)n(o,i);t&&(data[t]=data[t]||{loaded:!1,currentData:deepFreeze([]),historicData:[]})},prototypeAccessors={data:{configurable:!0}};prototypeAccessors.data.get=function(){return data[this.name]?data[this.name].currentData.toJS():null},Store.prototype.loaded=function(){var t=Object.keys(data).filter(function(t){return data[t].loaded}).length;if(t===Object.keys(data).length&&!this.triggered){var e={};Object.keys(data).map(function(t){e[t]=data[t].currentData.toJS()}),this.triggered=!0,trigger$1("global:data-loaded",e)}},Store.prototype.next=function(t){if(data[this.name].loaded=!0,(t=deepFreeze(t))!==data[this.name].currentData){for(data[this.name].historicData.push(data[this.name].currentData);data[this.name].historicData.length>10;)data[this.name].historicData.shift();data[this.name].currentData=t,trigger$1(this.name+"-store:changed",data[this.name].currentData.toJS())}this.loaded()},Store.prototype.previous=function(){data[this.name].historicData.length<1||(newState=data[this.name].historicData.pop(),data[this.name].currentData=newState,trigger$1(this.name+"-store:changed",data[this.name].currentData.toJS()))},Object.defineProperties(Store.prototype,prototypeAccessors),module.exports=Store;
