"use strict";var scope="undefined"!=typeof global?global:"undefined"!=typeof window?window:{},eventRegistry=scope.__eventRegistry=scope.__eventRegistry||{};function trigger(e,t){if(eventRegistry[e])for(var r,a=0,n=eventRegistry[e].length;r=eventRegistry[e][a],a<n;a+=1){if(!1===r(t))break}}function on(e,t){eventRegistry[e]||(eventRegistry[e]=[]),eventRegistry[e].push(t)}function off(e,t){if(eventRegistry[e])if("function"==typeof t){var r=eventRegistry[e].indexOf(t);r>=0&&eventRegistry[e].splice(r,1)}else eventRegistry[e]=[]}function one(e,t){var r=function(a){off(e,r),t(a)};on(e,r)}var events=Object.freeze({trigger:trigger,on:on,off:off,one:one}),scope$1="undefined"!=typeof window?window:{},data=scope$1.__glassbilStoreData=scope$1.__glassbilStoreData||{},trigger$1=trigger;function mirror(){return this}function deepFreeze(e){if(null===e||"function"==typeof e.toJS||"object"!=typeof e)return e;var t=Object.getOwnPropertyNames(e),r={toJS:{value:mirror.bind(e)}};Array.isArray(e)&&(e=e.slice(0).map(deepFreeze));for(var a=function(e,a){r[t[e]]={enumerable:!0,get:function(){return deepFreeze(a)},set:function(r){throw new Error('Cannot change property "'+t[e]+'" to "'+r+'" of an immutable object')}}},n=0,o=void 0;o=e[t[n]],n<t.length;n+=1)a(n,o);return Object.freeze(Object.create(Object.getPrototypeOf(e),r))}var Store=function(e,t){var r=this;if(this.name=e||"unnamed",this.triggered=!1,Object.keys(events).forEach(function(t){r[t]=function(r,a){r.indexOf(":")>=0?events[t](r,a):events[t](e+"-store:"+r,a)}}),"object"==typeof t)for(var a=Object.keys(t),n=function(t,n){r[a[t]]=function(t){var r=n(data[e].currentData,t,this.next.bind(this));r&&this.next(r)}.bind(r)},o=0,i=void 0;i=t[a[o]],o<a.length;o+=1)n(o,i);e&&(data[e]=data[e]||{loaded:!1,currentData:deepFreeze([]),historicData:[]})},prototypeAccessors={data:{configurable:!0}};prototypeAccessors.data.get=function(){return data[this.name]?data[this.name].currentData:null},Store.prototype.loaded=function(){var e=Object.keys(data).filter(function(e){return data[e].loaded}).length;if(e===Object.keys(data).length&&!this.triggered){var t={};Object.keys(data).map(function(e){t[e]=data[e].currentData.toJS()}),this.triggered=!0,trigger$1("global:data-loaded",t)}},Store.prototype.next=function(e){if(data[this.name].loaded=!0,(e=deepFreeze(e))!==data[this.name].currentData){for(data[this.name].historicData.push(data[this.name].currentData);data[this.name].historicData.length>10;)data[this.name].historicData.shift();data[this.name].currentData=e,trigger$1(this.name+"-store:changed",data[this.name].currentData)}this.loaded()},Store.prototype.previous=function(){if(!(data[this.name].historicData.length<1)){var e=data[this.name].historicData.pop();data[this.name].currentData=e,trigger$1(this.name+"-store:changed",data[this.name].currentData)}},Object.defineProperties(Store.prototype,prototypeAccessors),module.exports=Store;
